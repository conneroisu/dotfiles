# Initialize CLAUDE.md from Nix Flake

## Instructions for Claude Code Agent

When working with a project that has a `flake.nix` file, create a comprehensive `CLAUDE.md` documentation file that captures all available tools, utilities, and environment information from the Nix flake shell environment.

### Workflow Steps

1. **Locate and Analyze flake.nix**
   - Find the `flake.nix` file in the project root
   - Read and parse the file contents
   - Identify the development shell configuration (`devShells.default` or similar)

2. **Extract Environment Information**
   - **Build Inputs**: List all packages in `buildInputs` or `nativeBuildInputs`
   - **Shell Hook**: Capture any shell initialization scripts
   - **Environment Variables**: Document any environment variables set
   - **Aliases**: Note any command aliases defined
   - **Scripts**: Identify any custom scripts or tools

3. **Test the Environment**
   - Enter the Nix shell: `nix develop` or `nix-shell`
   - Run `which <tool>` for key tools to verify availability
   - Check versions: `<tool> --version` for important packages
   - Test any custom scripts or aliases
   - Document the shell prompt if it changes

4. **Create CLAUDE.md Structure**

Create a comprehensive markdown file with the following sections:

```markdown
# Claude Development Environment

> This file documents the Nix flake development environment for Claude Code agents.
> Generated from flake.nix analysis and environment testing.

## Quick Start

```bash
# Enter the development environment
nix develop

# Or if using legacy nix-shell
nix-shell
```

## Available Tools & Packages

### Development Tools
- [List programming languages, compilers, interpreters]
- [List editors, IDEs, or development utilities]
- [List version control tools]

### Build & Package Management
- [List build systems, package managers]
- [List dependency management tools]

### Testing & Quality Assurance
- [List testing frameworks, linters, formatters]
- [List code analysis tools]

### Database & Services
- [List database tools, CLI clients]
- [List service management tools]

### System Utilities
- [List shell utilities, command-line tools]
- [List file manipulation, text processing tools]

### Project-Specific Tools
- [List any domain-specific or project-specific utilities]

## Environment Variables

[Document any environment variables set by the flake]

## Shell Configuration

### Aliases
[List any command aliases]

### Functions
[Document any shell functions]

### Custom Scripts
[List any project-specific scripts available]

## Package Versions

[Document versions of key tools]

## Usage Examples

### Common Development Tasks
[Provide examples of typical development workflows]

### Building the Project
[Document build commands and processes]

### Running Tests
[Document testing procedures]

### Development Server
[Document how to start development services]

## Troubleshooting

### Common Issues
[Document known issues and solutions]

### Environment Debugging
[Provide debugging commands and techniques]

## Nix Flake Details

### Flake Structure
[Document the flake inputs, outputs, and structure]

### Updating Dependencies
```bash
# Update flake lock file
nix flake update

# Update specific input
nix flake update <input-name>
```

### Shell Variants
[Document any alternative development shells available]

---
*Last updated: [DATE]*
*Generated by: Claude Code Agent*
```

### Information Collection Commands

Use these commands to gather comprehensive environment information:

```bash
# Enter the development environment
nix develop

# List all available commands
compgen -c | sort | uniq

# Check specific tool versions (adapt as needed)
node --version 2>/dev/null || echo "Node.js not available"
python --version 2>/dev/null || echo "Python not available"
go version 2>/dev/null || echo "Go not available"
rustc --version 2>/dev/null || echo "Rust not available"
java -version 2>/dev/null || echo "Java not available"

# List environment variables
env | grep -E "(PATH|SHELL|LANG|HOME)" | sort

# Check shell initialization
echo $SHELL
echo $PS1

# List aliases
alias

# Check for custom functions
declare -F

# Show PATH components
echo $PATH | tr ':' '\n'
```

### Flake.nix Analysis Points

When reading the flake.nix file, pay attention to:

- **Inputs**: External dependencies and nixpkgs versions
- **Outputs**: Available development shells and packages
- **BuildInputs**: Primary packages and tools
- **NativeBuildInputs**: Build-time dependencies
- **ShellHook**: Initialization scripts
- **Environment variables**: Custom environment setup
- **Overlays**: Package modifications or additions
- **Systems**: Supported platforms (x86_64-linux, aarch64-darwin, etc.)

### Documentation Best Practices

1. **Be Specific**: Include exact package names and versions
2. **Provide Examples**: Show actual usage commands
3. **Include Context**: Explain why specific tools are included
4. **Update Regularly**: Note when the documentation was last updated
5. **Test Commands**: Verify all documented commands actually work
6. **Cross-Reference**: Link related tools and workflows

### Example Tools to Document

Common categories to look for in flake.nix:

**Languages & Runtimes:**
- nodejs, python3, go, rustc, gcc, java, php, ruby

**Development Tools:**
- git, vim, vscode, tmux, zsh, fish, starship

**Build Systems:**
- make, cmake, ninja, bazel, cargo, npm, yarn, pip

**Database Tools:**
- postgresql, mysql, sqlite, redis-cli, mongodb

**Cloud & DevOps:**
- docker, kubectl, terraform, ansible, aws-cli

**Text Processing:**
- jq, yq, sed, awk, grep, ripgrep, fd

### Error Handling

If any step fails:
1. Document the failure in CLAUDE.md
2. Note any missing dependencies
3. Provide alternative approaches
4. Include troubleshooting steps

### Final Steps

1. **Validate the Environment**: Test key workflows after documentation
2. **Version Control**: Commit the CLAUDE.md file to the repository
3. **Update .gitignore**: Ensure CLAUDE.md is tracked (don't ignore it)
4. **Test Documentation**: Verify all commands and examples work
5. **Notify**: Mention the CLAUDE.md creation in your summary

### Notes

- Always test the environment before documenting
- Include both successful and failed command attempts
- Document any platform-specific behavior
- Note any performance characteristics of tools
- Include links to official documentation where helpful
